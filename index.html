<!doctype html>
<html>

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>reveal.js</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<!-- <link rel="stylesheet" href="dist/theme/white.css"> -->
	<!-- <link rel="stylesheet" href="dist/theme/league.css"> -->
	<!-- <link rel="stylesheet" href="dist/theme/dracula.css"> -->
	<link rel="stylesheet" href="dist/theme/moon.css">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<!--

	Questions:
	- can I show a screenshot of the vLAC web user interface?
	- are challenges ok to detail?
	- high level diagrams OK?

-->


<body>
	<div class="reveal">
		<div class="slides">
			<!-- <section data-background-image="images/cover-slide-background.png"> -->
			<section data-background-image="images/helicopter-background.jpg">
				<img src="images/ecli-header.png" class="r-stretch">
				<br><br><br><br><br><br><h2>Emergency Caller Location Information</h2>
				<h4>
					Tim Higgs / ECLI Solutions Architect / MBIE
				</h4>
			</section>
			<section data-background-image="images/ecli-header.png">
				<img src="images/ecli-header.png">
				<h3>A journey through what ECLI is,<br>
					what we have designed and built and why,<br>
					 and some challenges we have overcome</h3>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>About Me</h2>
				<ul>
					<li>BSc Comp Sci, BA Philosophy Victoria University</li>
					<li>25+ years in web application development</li>
					<li>3 1/2 years as a Solutions Architect at MBIE on ECLI including DevOps CI/CD and K8s/OCP development</li>
					<li>Interests in the blending of technology with design, adventure travel (including skiing, diving and 
						motorbiking) and music</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Introduction</h2>
				<ul>
					<li>Every year millions of emergency calls are made in New Zealand and being able to ascertain 
						the location of an emergency is critical to enable emergency service to
						best help those in need</li>
					<li>These days most people have a mobile device on them capable of providing accurate location; currently
						84% of 111 calls originate from a mobile (16% from landlines) which works out to around 1.3 million
						genuine calls on mobile networks
					</li>
						<ul>
							<li>Leverage that for ascertaining location</li>
						</ul>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h3>Emergency calls are often times of great stress.</h3>
				<ul>
					<li>Additionally, people may not know where they are (there have been instances of hikers lost in remote
						locations)</li>
					<li>There are frequent instances of people being unable to speak during a call (such as instances of
						domestic violence and injury)</li>
					<li>There are times when people hang up before there’s been a chance to get their location from them
						(such as depressive or suicidal calls).</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>What is ECLI?</h2>
				<ul>
					<li>Project developed within Ministry of Business, Innovation and Employment as part of the 
						Government's Communications portfolio</li>
					<li>Receives and processes mobile location information when an emergency (111) call made
						from a mobile device over a cellular network details and makes the likely 
						location of the caller available to authorised emergency service providers</li>
					<li>This helps them respond to emergencies as quickly as possible.</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Emergency Service Providers</h2>
				<ul>
					<li>New Zealand Police</li>
					<li>Fire and Emergency New Zealand</li>
					<li>St John and Wellington Free Ambulance</li>
				</ul>
			</section>
			<section data-background-image="images/cover-slide-background.png" style="color:black">
				<h5>ECLI saves lives by<br>
					decreasing the time taken to verify location and<br> reducing the average incident dispatch time</h5>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>ECLI Background</h2>
				<ul>
					<li>An inital build of the service originally deployed in 2017</li>
					<li>In 2019 ECLI undertook a redesign + rebuild for greater flexibility, to leverage containerisation
						and incorporate modern DevOps practices along with a suite of automated regression tests</li>
					<li>This new system successfully went live in October 2021 and the new platform has realised the rebuild goals</li>
				</ul>
			</section>
				<section data-background-image="images/energy-background.jpg">
					<br><br><br>
					<h2 style="color:white">High availability is<br>essential<br>as ECLI is a critical service</h2>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Why Containerisation?</h2>
				<ul>
					<li>Containerisation promotes component delineation and supports a scalable microservices architecture</li>
					<li>Leverage CI/CD integration</li>
					<li>Safer releases when deploy a service update independent of
					others</li>
					<li>Running the same service & bundled runtime anywhere helps testing and deployment</li>
					<li>Zero downtime with rolling deployments with multiple containers per microservice</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Why Kubernetes?</h2>
				<ul>
					<li>Also for its flexibility, portability and provision of PaaS for containers</li>
					<li>Very widely used and great longterm solution - represents the future</li>
					<li>Network policies and RBAC allow multiple locked down, segregated environments on a single cluster</li>
					<li>IaC empowers developers through access to networking etc and makes many things possible including ease
						 of standing up new environments</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Why DCSG Govt.Container?</h2>
				<ul>
					<li>Managed Datacom OpenShift offering for Govt clients providing</li>
					<li>Multiple data centres for high availability and DR with low latency between Auckland and Hamilton</li>
					<li>Ease of integration with other existing ECLI components already in DCSG with onshore support</li>
					<li>OpenShift provides K8s-compatibility and native support for Helm</li>
					<li>Ease of integration with Microsoft Azure DevOps and deployment of ADO build agents within DCSG
						infrastructure and network</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Constraints: what makes things harder?</h2>
				<ul>
					<li>Partial “air gap” due to security</li>
					<li>Locked-down environment via multiple layers of access</li>
					<li>Bandwidth constraints</li>
					<li>Some required network messaging protocols, such as for 3G mobile, aren’t supported with public
						cloud</li>
					<li>Managed service means full admin not possible</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Architecture details</h2>
				<ul>
					<li>Backbone services, including integration into mobile network operators</li>
					<ul>
						<li>Vodafone, 2Degrees and Spark</li>
					</ul>
					<li>Supporting DCSG infrastructure for network connections and also VMs to facilitate DevOps</li>
					<li>Container platform provided by OpenShift</li>
					<li>Azure for DevOps and some cloud services</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Core ECLI Containerised Services</h2>
				<ul>
					<li>Containerised microservices with APIs built in .NET on Linux</li>
					<li>Containerised message bus (RabbitMQ) with high-availability</li>
					<li>Containerised NoSQL MongoDB database for short-lived, schema-less data with high-availability</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Azure DevOps</h2>
				<ul>
					<li>Pipelines for build, release and repeatable tasks (e.g. failover)</li>
					<li>Azure build agents allow a more secure model of running behind firewalls and reaching out for jobs</li>
					<li>Integration with Azure services such as Git, KeyVault and Container Registry</li>
					<li>Wrap scripts running on VMs in pipelines</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<p>
					<b>High-Level Architecture Overview of ECLI</b><br>
					<img src="images/ECLI-Architecture-Overview.png">
				</p>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>MongoDB</h2>
				<ul>
					<li>Replication for HA within a cluster/environment</li>
					<li>Stretch cluster across data centres</li>
					<li>Standby MongoDB replica to allow quorum in a data centre</li>
					<li>Stretch cluster across data centres</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>MongoDB Overview</h2>
				<img src="images/mongodb.png">
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Helm</h2>
				<ul>
					<li>The package manager for Kubernetes</li>
					<li>Charts represent a bundle of K8s/OCP manifests and container image references</li>
					<li>Charts can contain upstream subcharts</li>
					<li>Deployment mechanism allows allows easy install and upgrade into a container platform</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Helm Continued</h2>
				<ul>
					<li>OO design - clean naming for clear delineation between microservices</li>
					<li>ECLI treat charts as “applications” bundles</li>
					<li>This smaller "application" bundle split gives us installation flexibility: same OCP  
						project, different projects, multiple times in the same project or different clusters</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Why Helm vs an Operator?</h2>
				<ul>
					<li>Reduced complexity</li>
					<li>Was more common at rebuild outset and ECLI had team familiarity with it</li>
					<li>Some use-cases better suit Helm; we can install multiple times in a single project and we have
						leveraged "inheritance" through subcharts</li>
					<li>Easier for CI/CD</li>
					<li>Container registries support chart storage</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header.png">
				<h2>Environments</h2>
				<ul>
					<li>Test and Stable on ARO</li>
					<li>SIT and PROD on Govt.Container</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header.png">
				<h2>Namespaces, networking and RBAC</h2>
				<ul>
					<li>SIT and PROD</li>
					<li>Delineation between roles such as developer and support along with service accounts for secure
				deployment</li>
					<li>Network policies to enforce separation and the ability for developers to be in control</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header.png">
				<h2>Challenges</h2>
				<p>Some challenges and issues we have faced</p>
				<ul>
					<li>Deployment of lots of new container images as well as patching of our clusters has meant throttling
						 of our bandwidth and slow image pull times</li>
					<li>Lack of insights into failures of individual components (especially when not presenting as complete
						outage) requiring monitoring</li>
					<li>Integration into automated alerting ticketing system</li>
					<li>Inter-data centre connection outage leading to MongoDB disruption</li>
				</ul>
			</section>

			<section data-background-image="images/energy2-background.jpg">
				<h2 style="color:white">Reliability through Availability</h2>
			</section>

			<section data-background-image="images/ecli-header.png">
				<h2>Multiple Clusters</h2>
				<ul>
					<li>Addtional dev/test cluster (Azure ARO) - greater control and allows testing of upgrades</li>
					<li>For resiliency and high availability we have 2 geographically separated prod OCP clusters</li>
					<li>Sometimes backbone connections (including MNOs) into a data centre need to be taken down for upgrades etc. having the 2 clusters
						allows quick failover to be done</li>
					<li>F5 with global traffic management</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Failover</h2>
				<ul>
					<li>DNS strategy with short TTL</li>
					<li>Ability to trigger failover via ADO pipeline that takes a few seconds to run</li>
					<li>Promotion of new MongoDB primary and demotion to standby</li>
					<li>Quick failover between them with a LIVE/NONLIVE setup</li>
					<li>Ability for NONLIVE deployments and smoke testing prior to LIVE deployment</li>
					<li>Manual and automated failover</li>
					<li>Automated detection of LIVE not being healthy and NONLIVE promoted</li>
					<li>DNS change and MongoDB primary shifted to new LIVE data centre environment</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<b>Failover Overview</b>
				<img src="images/Failover.png">
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Container Registry</h2>
				<ul>
					<li>Container registry solution within each cluster to facilitate quick image pulls and remove external Azure cloud 
						dependency</li>
					<li>Improve container image delivery for constrained bandwidth and reduced risk with dependency on
						external cloud-hosted registry</li>
					<li>Custom Helm chart that incorporates a Docker registry as well as image synchronisation script
						using Skopeo run as a CronJob and images stored on a PVC</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header.png">
				<h2>Monitoring and alerting</h2>
				<ul>
					<li>Dynatrace - cloud-hosted service and OCP operator</li>
					<li>Integration with ticket management for 24/7 support</li>
					<li>Alert profiles based upon certain observed errors etc</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Realised benefits of the new platform</h2>
				<ul>
					<li>Great uptime</li>
					<li>Safe deployments that are easy and repeatable</li>
					<li>Automated test suite</li>
					<li>Automated container image rebuilding for patching</li>
					<li>Enhanced security through DevSecOps such as container image scanning</li>
					<li>Scalable platform for adding new applications</li>
					<li>Ongoing ECLI service certification (changes & new applications) is helped by certified PaaS</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Next: R&A Data Science application</h2>
				<ul>
					<li>We require a lot of analysis over our data to help provide insights, troubleshoot
						potential issues & provide reports</li>
					<li>We are replatforming this Data Workshop application onto OpenShift so it
						can work securely with various data sources and provide a flexible platform 
						for data scientists/engineers to 
						work with the tools that they need and want</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Details</h2>
				<ul>
					<li>Containerised workloads such as Apache Airflow and Postgres</li>
					<li>Apache Airflow provides workflow engine</li>
					<li>Integration with PowerBI for reporting</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Future</h2>
				<p>
					The service has become a critical component of the emergency response system, significantly 
					contributing to improving public safety outcomes and saving lives of New Zealanders.
				</p>
				<p>
					With anticipation of a higher number of emergency calls being made over new technologies, including 
					5G, and Voice over Wi-Fi, ongoing enhancements to the Service will ensure it remains current. 
				</p>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Questions?</h2>
			</section>
			<section data-background-image="images/ecli-header.png">
				<h2>Further details/references:</h2>
				- [ ]
			</section>
		</div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
		});
	</script>
</body>

</html>