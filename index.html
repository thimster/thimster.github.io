<!doctype html>
<html>

<!-- 
#######  #####  #       ### 
#       #     # #        #  
#       #       #        #  
#####   #       #        #  
#       #       #        #  
#       #     # #        #  
#######  #####  ####### ### 

2023 / Tim Higgs / MBIE / Emergency Caller Location Information
Welcome to my slides :)
 -->

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

	<title>ECLI - Red Hat OpenShift Presentation</title>

	<link rel="stylesheet" href="dist/reset.css">
	<link rel="stylesheet" href="dist/reveal.css">
	<!-- <link rel="stylesheet" href="dist/theme/white.css"> -->
	<!-- <link rel="stylesheet" href="dist/theme/league.css"> -->
	<!-- <link rel="stylesheet" href="dist/theme/dracula.css"> -->
	<link rel="stylesheet" href="dist/theme/moon.css">

	<!-- Theme used for syntax highlighted code -->
	<link rel="stylesheet" href="plugin/highlight/monokai.css">
</head>

<body>
	<div class="reveal">
		<div class="slides">
			<!-- <section data-background-image="images/cover-slide-background.png"> -->
			<section data-background-image="images/helicopter-background.jpg">
				<img src="images/ecli-header.png" class="r-stretch">
				<!-- <br><br> -->
				<h4>Tim Higgs / ECLI Solutions Architect / MBIE</h4>
				<br><br><br><br>
				<h2>Emergency Caller Location Information</h2>
			</section>
			<section data-background-image="images/ecli-header-narrow.png">
				<img src="images/ecli-header.png">
				<h3>Our journey today:</h3>
				<h4>What is ECLI<br>and<br>how does MongoDB fit into the picture?</h4>
			</section>

			<section data-background-image="images/ecli-header-narrow.png" data-transition="zoom">
				<h2>About Me</h2>
				<ul>
					<li>BSc Comp Sci, BA Philosophy Victoria University.</li>
					<li>25+ years in web application development.</li>
					<li>4 years as a Solutions Architect at MBIE on ECLI including DevOps CI/CD and Kubernetes-compatible
						OpenShift development.</li>
					<li>Interests in the blending of technology with design, adventure travel (including skiing, diving and 
						motorbiking) and music.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Introduction</h2>
				<p>Every year millions of emergency calls are made in New Zealand.</p>
				<p>Being able to ascertain the location of an emergency is critical to enable emergency service to
						best help those in need.</p>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Mobile Phones</h2>
				<p>These days most people have a mobile device on them that can be used to calculate an accurate location:</p>
				<ul>
					<li>Currently 84% of 111 calls originate from a mobile (16% from landlines).</li>
					<li>That works out to around 1.3 million genuine calls on mobile networks.</li>
				</ul>
				<br><br>
				<h4>It makes sense to ascertain mobile location to aid emergency services.</h4>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h3>Emergency calls are often times of great stress. Additionally:</h3>
				<ul>
					<li>People may not know where they are (such as hikers lost in remote
						locations).</li>
					<li>There are frequent instances of people being unable to speak during a call (such as 
						domestic violence and injury).</li>
					<li>There are times when people hang up before there’s been a chance to get their location from them
						(such as depressive or suicidal calls).</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png" data-transition="convex">
				<h2>What is ECLI?</h2>
				<ul>
					<li>A service within Ministry of Business, Innovation and Employment delivered as part of the 
						Government's Communications portfolio.</li>
					<li>The ECLI service receives and processes mobile location information from emergency (111) call made
						from mobile devices over cellular networks details.</li>
					<li>The likely location of the device is then made available to authorised emergency service providers
						 helping them respond as quickly as possible.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Emergency Service Providers</h2>
				<ul>
					<li>New Zealand Police</li>
					<li>Fire and Emergency New Zealand</li>
					<li>St John and Wellington Free Ambulance</li>
				</ul>
			</section>

			<section data-background-image="images/cover-slide-background.png" style="color:black" data-transition="zoom">
				<h3><br>ECLI saves lives by<br>
					decreasing the time taken to verify location and<br> reducing the average incident dispatch time</h3>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>ECLI Background</h2>
				<ul>
					<li>An inital build of the service was deployed in 2017.</li>
					<li>In 2019 ECLI undertook a redesign + rebuild for greater flexibility, to leverage containerisation
						and incorporate modern DevOps including a suite of automated regression tests.</li>
					<li>The new platform successfully went live in October 2021 and has already realised
						many of the rebuild goals.</li>
				</ul>
			</section>

			<section data-background-image="images/energy-background.jpg">
				<br><br><br>
				<h2 style="color:white">Availability is essential as ECLI provides a critical<br>service</h2>
			</section>
			
			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Why Containerisation?</h2>
				<ul>
					<li>Containerisation promotes component delineation and a scalable microservices architecture.</li>
					<li>Leverage CI/CD for builds and deployments.</li>
					<li>Running the same code + bundled runtime anywhere helps testing and deployment.</li>
					<li>Safer releases through automated deployments of independent microservice updates.</li>
					<li>Zero-downtime with rolling deployments and multiple container instances per microservice.</li>
				</ul>
			</section>
			
			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Why Kubernetes?</h2>
				<ul>
					<li>Scalable, stable container runtime orchestrator.</li>
					<li>Flexibility, portability and provision of PaaS for containers.</li>
					<li>Very widely used and I believe it represents the future.</li>
					<li>Network policies and RBAC allow multiple locked-down, segregated environments on a single cluster.</li>
					<li>Code orchestration/IaC makes many things possible, such as the ease of standing up new environments and
						empowers developers to easily deploy new components.</li>
				</ul>
			</section>
			
			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Why DCSG's Govt.Container?</h2>
				<ul>
					<li>Onshore OpenShift offering for Government hosted and managed by Datacom.</li>
					<li>Data centres in Auckland and Hamilton with low latency for high availability and DR.</li>
					<li>Integration with existing ECLI components already in DCSG.</li>
					<li>OpenShift provides K8s-compatibility and native support for Helm.</li>
					<li>Microsoft Azure DevOps build agents easily deployed on existing DCSG infrastructure within the network.</li>
				</ul>
			</section>

			
			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Constraints:<br>what makes things harder for us?</h2>
				<ul>
					<li>Some required network messaging protocols, such as for 3G mobile, aren’t supported with public
						cloud.</li>
					<li>Security means locked-down clusters via multiple layers of access, similar
						to an <b>air gap</b>.</li>
					<li>Bandwidth constraints.</li>
					<li>Managed service means full <b>admin</b> not possible.</li>
					<li>Lack of "<b>true cloud elasticity</b>".</li>
				</ul>
			</section>
					
			<section data-background-image="images/architecture.jpg">
				<h2 style="color:white">ECLI Architecture</h2>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Architecture details</h2>
					<ul>
						<li>Backbone services, including integration into the 3 mobile network operators:</li>
						<ul>
							<li>Vodafone, 2Degrees and Spark.</li>
						</ul>
					<li>DCSG infrastructure for network connections and VMs to facilitate DevOps.</li>
					<li>Container platform provided by OpenShift.</li>
					<li>Azure for DevOps and some cloud services.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Linux Containerised Services</h2>
				<ul>
					<li>Containerised API-driven .NET microservices.</li>
					<li>Containerised RabbitMQ message bus.</li>
					<li>Containerised MongoDB NoSQL database for schemaless data storage.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Azure DevOps</h2>
				<ul>
					<li>Pipelines for build, release and repeatable tasks<br>(such as failover).</li>
					<li>Integration with Azure services such as Git, KeyVault and Container Registry.</li>
					<li>Azure build agents allow a more secure model of running behind firewalls and reaching out for jobs.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png" data-transition="zoom">
				<p>
					<b>High-Level Architecture Overview of ECLI</b><br>
					<img src="images/ECLI-Architecture-Overview.png">
				</p>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Why MongoDB?</h2>
				<ul>
					<li>ECLI require short-term storage of location information for emergency calls that can be quickly retrieved.</li>
					<li>Storing the data schemaless makes deployments easier, especially across multiple sites.</li>
					<li>Preference for well-supported open source projects with containerisation options.</li>
					<li>Replication support for high availability.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Database Containerisation</h2>
				<p>There are complexities, however databasse containerisation can provide great benefits:</p>
				<ul>
					<li>Easy to stand up new environments.</li>
					<li>Leverage same CI/CD model.</li>
					<li>Easier upgrades.</li>
					<li>Single containerisation platform.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Database Containerisation Challenges</h2>
				<ul>
					<li>Performance tuning.</li>
					<li>DBA knowledge learning curve.</li>
					<li>Complexities with replication setup.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>ECLI's MongoDB Setup</h2>
				<ul>
					<li>MongoDB version 5.</li>
					<li>TLS connections.</li>
					<li>High availability <b>replicaSet</b> with 1 primary and multiple secondaries.</li>
					<li>"<b>Stretch cluster</b>" across data centres for increased H.A. and failover.</li>
					<li>Low latency allowing synchronous replication.</li>
					<li>Non-voting "<b>standby secondary</b>" MongoDB replica allows a quorum in a data centre (3 out of 5).</li>
					<li>Reconfiguring the replicaSet member priorities triggers an election and changes the primary.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png" data-transition="none">
				<h2>MongoDB Overview</h2>
				<img src="images/mongodb.png">
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Helm: A K8s package manager</h2>
				<ul>
					<li><b>Helm Charts</b> represent a bundle of OpenShift manifests that have container image references.</li>
					<li>Easy to just deploy updates through changing the referenced image through an ADO variable,
						updated during the CI/CD process.</li>
					<li>Charts can contain upstream subcharts.</li>
					<li>Deployment mechanism allows allows easy installing, upgrading and deleting.</li>
					<li>MongoDB deployed as a Helm chart.</li>
				</ul>
			</section>
			<!-- <section data-background-image="images/ecli-header-narrow.png">
				<h2>More about Helm for us</h2>
				<ul>
					<li>OO design - clean naming and clear delineation between microservice bundles</li>
					<li>ECLI: treat a Helm chart as an “application" bundle</li>
					<li>This smaller "application" bundle split gives us installation flexibility:</li>
					<ul>
						<li>The same OCP project</li>
						<li>Different projects</li>
						<li>Multiple times into the same project</li>
						<li>Different clusters</li>
					</ul>
				</ul>
			</section>
			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Why Helm vs an Operator?</h2>
				<ul>
					<li>Reduced complexity</li>
					<li>Was more common at rebuild outset and ECLI had team familiarity with it</li>
					<li>Some use-cases better suit Helm; we can install multiple times in a single project and we have
						leveraged "inheritance" through subcharts</li>
					<li>Easier for CI/CD</li>
					<li>Container registries support chart storage</li>
				</ul>
			</section> -->

			<!-- <section data-background-image="images/ecli-header-narrow.png">
				<h2>Projects, networking and RBAC</h2>
				<ul>
					<li>SIT and PROD separated by access permissions and networking</li>
					<li>Delineation between roles such as <b>developer</b> vs <b>admin</b> vs <b>support</b> along with <b>service accounts</b> for secure
				deployment</li>
					<li><b>Network Policies</b> to enforce separation between projects and services</li>
					<li><b>IaC</b> gives developers control of this through code (that goes into Git)</li>
				</ul>
			</section> -->

			<!-- 
			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Some challenges</h2>
				<ul>
					<li>Deployment of lots of new container images as well as patching of our clusters has meant throttling
						 of our bandwidth and slow image pull times</li>
					<li>Lack of insights into failures of individual components (especially when not presenting as complete
						outage) requiring monitoring</li>
					<li>Integration into automated alerting ticketing system</li>
					<li>Inter-data centre connection outage leading to MongoDB disruption</li>
				</ul>
			</section> -->

			<section data-background-image="images/energy2-background.jpg" data-transition="concave">
				<h2 style="color:white">Reliability through Availability</h2>
			</section>

			<!-- <section data-background-image="images/ecli-header-narrow.png">
				<h2>Multiple Clusters</h2>
				<ul>
					<li>Azure ARO dev/test cluster - greater control of this and allows OpenShift upgrade testing</li>
					<li>For resiliency and high availability we have 2 geographically separated prod OCP clusters</li>
					<li>Handle backbone service connections (such as MNOs) into data centres being taken down for upgrades</li>
					<li>Smoke testing NONLIVE deployments prior to LIVE deployment</li>
				</ul>
			</section> -->

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Things are surprisingly complex</h2>
				<p>The complexity of our system with all its components and their interconnections mean we often require flexibility.</p>
				<ul>
					<li>Patching and upgrades of infrastructure components.</li>
					<li>Smoke testing of releases.</li>
					<li>Unplanned incidents.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Multiple Environments</h2>
				<ul>
					<li>We have multiple environments across 3 OpenShift clusters.</li>
					<li>MongoDB replicaSet is installed (via Helm) into each of them.</li>
					<li>Data stored on <b>Persistent Volume Claims</b>.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Failover</h2>
				<ul>
					<li>F5 with global traffic management: DNS strategy with short TTL.</li>
					<li>Manual and automated failover.</li>
					<li>Automated detection of LIVE not being healthy and NONLIVE promoted.</li>
					<li>Triggered failover via ADO pipeline - takes a few seconds to run.</li>
					<li>Environment statuses changed, traffic manager DNS change and MongoDB primary shifted to new LIVE environment in other data centre.</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header-narrow.png" data-transition="zoom">
				<h2>Failover Overview</h2>
				<img src="images/Failover.png">
			</section>
			<section data-background-image="images/ecli-header-narrow.png" data-transition="zoom">
				<h2>Failover Overview</h2>
				<ul>
					<li>Failover reconfigures MongoDB replicaSet.</li>
					<li>Change of replicaSet priorities allows Primary to be moved and for secondaries to favour the new LIVE site.</li>
					<li>Non-voting repliocaSet member changed from one site to the other site:</li>
					<ul>
						<li>As it already stores a copy of the data, it comes online immediately.</li>
					</ul>
					<li>Quorum now held in the new LIVE site.</li>
				</ul>
			</section>
			<!-- <section data-background-image="images/ecli-header-narrow.png">
				<h2>Container Registry</h2>
				<ul>
					<li>Container registry solution within each cluster to facilitate quick image pulls and remove external Azure cloud 
						dependency</li>
					<li>Improve container image delivery for constrained bandwidth and reduced risk with dependency on
						external cloud-hosted registry</li>
					<li>Custom Helm chart that incorporates a Docker registry as well as image synchronisation script
						using <b>Skopeo</b> run as a CronJob and images stored on a PVC</li>
				</ul>
			</section> -->

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Health Checks</h2>
				<ul>
					<li>To ensure application heath, we make use of <b>liveness</b> and <b>readiness</b> checks in Kubernetes.</li>
					<li>Failure will trigger auto-healing to restart containers and prevent traffic to affected containers.</li>
					<li>We incorporate MongoDB checking where appropriate.</li>
					<li>Our main site healthcheck incorporates MongoDB checking; failure of this will lead to an automatic failover.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Monitoring and alerting</h2>
				<ul>
					<li>Dynatrace - cloud-hosted service for application support.</li>
					<li>Monitoring of minimum number of MongoDB containers as well as connectivity.</li>
					<li>Alert profiles based upon certain observed errors.</li>
					<li>Integration with ticket management for 24/7 support and MS Teams notifications.</li>
				</ul>
			</section>

			<section data-background-image="images/ecli-header-narrow.png">
				<h2>We've realised these benefits</h2>
				<ul>
					<li>Great uptime with zero-downtime releases.</li>
					<li>MongoDB has been very reliable.</li>
					<li>Safe deployments that are easy and repeatable aided by automated test suite.</li>
					<li>Automated container image rebuilding for patching.</li>
					<li>Enhanced security through DevSecOps such as container image scanning.</li>
					<li>We now have a scalable platform for adding new applications to.</li>
				</ul>
			</section>
			<!-- <section data-background-image="images/ecli-header-narrow.png">
				<h2>Currently: Replatforming Data Science application</h2>
				<ul>
					<li>We require a lot of analysis over our data to help provide insights, troubleshoot
						potential issues & provide reports</li>
					<li>We are replatforming this Data Workshop application onto OpenShift so it
						can work securely with various data sources and provide a flexible platform 
						for data scientists/engineers to 
						work with the tools that they need and want</li>
				</ul>
			</section>
			<section data-background-image="images/ecli-header-narrow.png">
				<h2>Some Extra Data Workshop Details</h2>
				<ul>
					<li>Containerised Apache Airflow and Postgres</li>
					<li>Apache Airflow provides a workflow engine</li>
					<li>Integration with Microsoft PowerBI, via a PowerBI gateway for report building</li>
				</ul>
			</section> -->
			<section data-background-image="images/ecli-header-narrow.png" data-transition="zoom">
				<h2>In summary and to the future...</h2>
				<p>
					These days the ECLI service has become a critical component of the emergency response system, 
					helping improve public safety outcomes and saving lives of New Zealanders.
				</p>
				<p>
					With anticipation of a higher number of emergency calls being made over new technologies, including 
					5G, and Voice over Wi-Fi, ongoing enhancements to the service will ensure it remains current. 
				</p>
			</section>
			<section data-background-image="images/ecli-header-narrow.png" data-transition="concave">
				<h2>Questions?</h2>
			</section>
			<!-- <section data-background-image="images/ecli-header-narrow.png">
				<h2>Further details/references:</h2>
				- [ ]
			</section> -->
		</div>
	</div>

	<script src="dist/reveal.js"></script>
	<script src="plugin/notes/notes.js"></script>
	<script src="plugin/markdown/markdown.js"></script>
	<script src="plugin/highlight/highlight.js"></script>
	<script>
		// More info about initialization & config:
		// - https://revealjs.com/initialization/
		// - https://revealjs.com/config/
		Reveal.initialize({
			hash: true,

			// Learn about plugins: https://revealjs.com/plugins/
			plugins: [RevealMarkdown, RevealHighlight, RevealNotes]
		});
	</script>
</body>

</html>
